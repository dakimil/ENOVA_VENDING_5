<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>ENOVA Vending</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f8fafc;
            margin: 0;
            padding: 0;
        }
        .scroll-izaberi {
            width: 278px;
            position: absolute;
            top: 12px;
            left: 20px;
            background: #e0f0ff;
            border: 2px solid #ccc;
            padding: 8px 14px;
            border-radius: 10px;
            animation: blink 5s ease-in-out infinite;
            display: inline-block;
        }
        .scroll-izaberi span {
            font-size: 17px;
            font-weight: bold;
            color: #003366;
        }
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.30; }
        }
        .lang-selector {
            position: fixed;
            top: 10px;
            right: 40px;
            display: flex;
            gap: 12px;
            z-index: 9999;
        }
        .lang-selector img {
            width: 42px;
            height: 30px;
            border: 2px solid #ccc;
            border-radius: 4px;
            transition: transform 0.2s, border 0.2s;
        }
        .lang-selector img:hover {
            transform: scale(1.1);
            border-color: #1976d2;
        }
        .lang-msg-global {
            position: absolute;
            top: 52px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #e3f2fd;
            padding: 6px 16px;
            border: 1px solid #90caf9;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            color: #1565c0;
            z-index: 9999;
            box-shadow: 0 0 6px rgba(0,0,0,0.1);
        }
        .flash-msg {
            text-align: center;
            padding: 12px;
            margin: 10px auto;
            width: 90%;
            max-width: 500px;
            border-radius: 8px;
            font-weight: bold;
            font-size: 17px;
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .video-reklama {
            width: 480px;
            max-width: 97vw;
            margin: 18px auto 0 auto;
            display: block;
            border-radius: 12px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.15);
        }
        .wrapper {
            margin: 0 auto;
            max-width: 1700px;
            width: 100%;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 40px 26px;
            justify-items: center;
            justify-content: center;
            margin: 0 auto;
            padding: 28px 0 20px 0;
            width: 100%;
            box-sizing: border-box;
        }
        .kartica {
            position: absolute;
            background: #fff;
            border-radius: 14px;
            box-shadow: 0 2px 10px #c4c4c4;
            padding: 16px 10px 14px 10px;
            width: 205px;
            max-width: 94vw;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .kartica img {
            width: 66px;
            height: 96px;
            object-fit: contain;
            margin-bottom: 8px;
        }
        .kartica h3 {
            margin: 6px 0 4px 0;
            font-size: 18px;
            color: #111;
        }
        .kartica p {
            margin: 0 0 8px 0;
            color: #444;
            font-size: 16px;
        }
        .kartica button {
            width: 100%;
            background: #2196f3;
            color: white;
            font-size: 16px;
            padding: 7px 0;
            border: none;
            border-radius: 7px;
            cursor: pointer;
            transition: background 0.2s;
        }
        .kartica button:disabled {
            background: #ccc;
            color: #666;
            cursor: not-allowed;
        }
        .kartica button:hover:not(:disabled) {
            background: #1766a0;
        }
        @media (max-width: 1200px) {
            .grid { grid-template-columns: repeat(3, 1fr); }
            .kartica { width: 164px; }
            .video-reklama { width: 300px; }
        }
        @media (max-width: 900px) {
            .grid { grid-template-columns: repeat(2, 1fr); }
            .kartica { width: 140px; }
            .video-reklama { width: 180px; }
            .grid { gap: 10px; }
        }
        @media (max-width: 600px) {
            .grid { grid-template-columns: 1fr; }
            .kartica { width: 92vw; }
        }
        .tasteri-levo-gore {
            position: fixed;
            top: 70px;
            left: 18px;
            z-index: 10000;
            display: flex;
            gap: 12px;
        }
        .tasteri-levo-gore form { margin: 0; }
        .tasteri-levo-gore button {
            padding: 14px 28px;
            font-size: 20px;
            border: none;
            border-radius: 10px;
            color: #fff;
            cursor: pointer;
        }
        .tasteri-levo-gore .servis-btn { background: #ff9800; }
        .tasteri-levo-gore .verif-btn { background: #e53935; }
        #verifikacija-kutija {
            position: fixed;
            top: 130px;
            left: 18px;
            z-index: 10001;
            display: none;
            flex-direction: column;
            align-items: flex-start;
        }
        #verifikacija-kutija .flash-msg {
            background: #f8d7da;
            color: #721c24;
            border-color: #f5c6cb;
            margin-bottom: 10px;
            min-width: 260px;
            text-align: left;
        }
        #verifikacija-kutija .dugmici {
            display: flex;
            gap: 10px;
        }
        #verifikacija-kutija button {
            padding: 10px 18px;
            font-size: 17px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            color: #fff;
        }
        #verifikacija-kutija .verifikuj-btn { background: #388e3c; }
        #verifikacija-kutija .nazad-btn { background: #757575; }
    </style>
</head>
<body>
    <!-- pomeranje kartica -->
    <script>
        dragElement(document.getElementById("proizvod"));

        function dragElement(elmnt) {
            var pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
            if (document.getElementById(elmnt.id + "header")) {
                // if present, the header is where you move the DIV from:
                document.getElementById(elmnt.id + "header").onmousedown = dragMouseDown;
            }
            else {
            // otherwise, move the DIV from anywhere inside the DIV:
            elmnt.onmousedown = dragMouseDown;
            }

        function dragMouseDown(e) {
            e = e || window.event;
            e.preventDefault();
            // get the mouse cursor position at startup:
            pos3 = e.clientX;
            pos4 = e.clientY;
            document.onmouseup = closeDragElement;
            // call a function whenever the cursor moves:
            document.onmousemove = elementDrag;
        }

        function elementDrag(e) {
            e = e || window.event;
            e.preventDefault();
            // calculate the new cursor position:
            pos1 = pos3 - e.clientX;
            pos2 = pos4 - e.clientY;
            pos3 = e.clientX;
            pos4 = e.clientY;
            // set the element's new position:
            elmnt.style.top = (elmnt.offsetTop - pos2) + "px";
            elmnt.style.left = (elmnt.offsetLeft - pos1) + "px";
        }

        function closeDragElement() {
            // stop moving when mouse button is released:
            document.onmouseup = null;
            document.onmousemove = null;
        }
}
    </script>
    <!-- promena stranice -->
    <script>
        document.body.addEventListener("keydown", (ev) => {
            if(ev.key == "h"){
                console.log("Promena stranice")

                window.location.href = 'login';
            }
        });
                </script>
    <!-- Blok za +18 verifikaciju (pojavljuje se iznad tastera) -->
    <div id="verifikacija-kutija">
        <div class="flash-msg">
            {{ poruke.verifikacija_potrebna }}
        </div>
        <div class="dugmici">
            <button id="verifikuj-btn" class="verifikuj-btn" onclick="potvrdiVerifikaciju()">
                {{ poruke.verifikuj }}
            </button>
            <button id="nazad-btn" class="nazad-btn" onclick="sakrijVerifikaciju()">
                ↩ {{ poruke.nazad }}
            </button>
        </div>
    </div>

    <!-- Tasteri gore levo -->
    <div class="tasteri-levo-gore">

        <!-- NOVO: automatska verifikacija lične karte preko Baš Čelik -->
        <form action="/verifikuj_automatski" method="post">
            <button type="submit" class="verif-btn" style="background:#009933;">
                Automatska Verifikacija Lične Karte
            </button>
        </form>
    </div>

    <div class="scroll-izaberi">
        <span>{{ poruke.izaberi }}</span>
    </div>

    <div class="lang-selector">
        <form method="post" action="/lang/sr">
            <button><img src="/static/zastave/sr.png" alt="SR"/></button>
        </form>
        <form method="post" action="/lang/de">
            <button><img src="/static/zastave/de.png" alt="DE"/></button>
        </form>
        <form method="post" action="/lang/en">
            <button><img src="/static/zastave/en.png" alt="EN"/></button>
        </form>
    </div>

    {% with messages = get_flashed_messages() %}
      {% if messages %}
        <div id="lang-msg-box" class="lang-msg-global">
          {{ poruke.jezik_promenjen }}
        </div>
        <script>
            setTimeout(() => {
                const el = document.getElementById("lang-msg-box");
                if (el) el.style.display = "none";
            }, 4000);
        </script>
      {% endif %}
    {% endwith %}

    <!-- VIDEO REKLAMA -->
    <video class="video-reklama" autoplay muted loop playsinline>
        <source src="/static/video/reklama.mp4" type="video/mp4">
        Vaš browser ne podržava video tag.
    </video>

    <div class="wrapper">
        <div class="grid">
        {% for artikal in artikli %}
            {% set i = loop.index0 %}
            {% set stanje = artikal.zaduzeno - artikal.prodato %}
            <div class="kartica" id="proizvod">
                <img src="{{ url_for('static', filename='slike/' + artikal.slika) }}" onerror="this.src='{{ url_for('static', filename='slike/default.jpg') }}'">
                <h3>{{ artikal.naziv }}</h3>
                <p>{{ artikal.cena }} &euro;</p>
                <p><strong>{{ poruke.stanje }}</strong>: {{ stanje }}</p>

                {% if stanje > 0 %}
                <form id="forma{{ i }}" method="post" action="/kupi/{{ i }}">
                    {% if artikal.plus18 %}
                        <button type="button" onclick="prikaziVerifikaciju({{ i }})">{{ poruke.kupi18 }}</button>
                    {% else %}
                        <button type="submit">{{ poruke.kupi }}</button>
                    {% endif %}
                </form>
                {% else %}
                    <button disabled>{{ poruke.nema }}</button>
                {% endif %}
            </div>
        {% endfor %}
        </div>
    </div>

    {% if poruka_audio %}
    <audio autoplay>
        <source src="/{{ poruka_audio }}" type="audio/mpeg">
    </audio>
    {% endif %}

    <script>
        let aktivniSlot = null;
        function prikaziVerifikaciju(id) {
            aktivniSlot = id;
            document.getElementById('verifikacija-kutija').style.display = 'flex';
        }
        function sakrijVerifikaciju() {
            aktivniSlot = null;
            document.getElementById('verifikacija-kutija').style.display = 'none';
        }
        function potvrdiVerifikaciju() {
            fetch("/verifikuj", { method: 'POST' }).then(() => {
                if (aktivniSlot !== null) {
                    document.getElementById('forma' + aktivniSlot).submit();
                }
            });
        }
        setTimeout(() => { window.location.reload(); }, 15000);
    </script>
</body>
</html>
